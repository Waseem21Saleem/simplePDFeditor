<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="theme-color" content="#1e293b">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Pro PDF Suite</title>
    
    <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/1644/1644129.png">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/1644/1644129.png">
    <link rel="manifest" href="./manifest.json?v=3">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = { darkMode: 'class', theme: { extend: { colors: { slate: { 850: '#151e2e' } } } } }
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.1/fabric.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
    
    <style>
        body { -webkit-tap-highlight-color: transparent; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        .thumb-group .preview-box { 
            display: none; position: fixed; z-index: 200; top: 50%; left: 50%; transform: translate(-50%, -50%); 
            box-shadow: 0 20px 60px rgba(0,0,0,0.9); pointer-events: none; border-radius: 12px; overflow: hidden; background: white;
        }
        .thumb-group:hover .preview-box { display: block; }
    </style>
</head>
<body class="bg-slate-900 text-slate-100 h-[100dvh] w-screen flex flex-col overflow-hidden font-sans">

    <div id="home-screen" class="screen flex flex-col flex-1 min-h-0 overflow-y-auto items-center p-6 w-full">
        <div class="w-full max-w-4xl flex justify-between items-center mb-8 pt-4">
            <h1 class="text-3xl font-bold text-blue-500 flex items-center gap-3">
                <img src="https://cdn-icons-png.flaticon.com/512/1644/1644129.png" alt="Logo" class="w-10 h-10 drop-shadow-md">
                PDF Suite
            </h1>
            <button id="install-btn" class="hidden bg-blue-600 hover:bg-blue-500 text-white px-4 py-2 rounded-lg font-medium shadow-lg transition-colors flex items-center gap-2">
                â¬‡ï¸ Install App
            </button>
        </div>
        
        <p class="text-slate-400 mb-10 text-center max-w-md">Your complete toolkit for editing, merging, organizing, and splitting PDF documents.</p>

        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 w-full max-w-4xl">
            <div onclick="navTo('editor')" class="bg-slate-800 border border-slate-700 hover:border-blue-500 rounded-2xl p-6 flex flex-col items-center gap-3 cursor-pointer transition-all hover:-translate-y-1 shadow-md">
                <div class="text-4xl">ğŸ“</div><div class="font-semibold text-center">Edit PDF</div><div class="text-xs text-slate-400 text-center">Draw, Type & Sign</div>
            </div>
            <div onclick="navTo('organize')" class="bg-slate-800 border border-slate-700 hover:border-blue-500 rounded-2xl p-6 flex flex-col items-center gap-3 cursor-pointer transition-all hover:-translate-y-1 shadow-md">
                <div class="text-4xl">âœ‚ï¸</div><div class="font-semibold text-center">Organize</div><div class="text-xs text-slate-400 text-center">Rearrange & Delete</div>
            </div>
            <div onclick="navTo('merge')" class="bg-slate-800 border border-slate-700 hover:border-blue-500 rounded-2xl p-6 flex flex-col items-center gap-3 cursor-pointer transition-all hover:-translate-y-1 shadow-md">
                <div class="text-4xl">ğŸ”—</div><div class="font-semibold text-center">Merge</div><div class="text-xs text-slate-400 text-center">Combine Multiple</div>
            </div>
            <div onclick="navTo('split')" class="bg-slate-800 border border-slate-700 hover:border-blue-500 rounded-2xl p-6 flex flex-col items-center gap-3 cursor-pointer transition-all hover:-translate-y-1 shadow-md">
                <div class="text-4xl">ğŸ”ª</div><div class="font-semibold text-center">Split</div><div class="text-xs text-slate-400 text-center">Extract Pages</div>
            </div>
        </div>
    </div>

    <div id="tool-header" class="hidden bg-slate-800 border-b border-slate-700 p-3 flex justify-between items-center shrink-0 w-full shadow-md z-50">
        <button onclick="attemptNavHome()" class="text-slate-300 hover:text-white flex items-center gap-1 px-2 py-1 bg-slate-700 rounded-lg">ğŸ”™ <span class="hidden sm:inline">Home</span></button>
        <div id="tool-title" class="font-semibold text-lg hidden sm:block">Tool Name</div>
        <div class="flex items-center gap-2" id="header-actions"></div>
    </div>

    <div id="editor-screen" class="screen hidden flex-col flex-1 min-h-0 relative w-full overflow-hidden">
        <div id="prop-bar" class="bg-slate-850 p-2 border-b border-slate-700 flex items-center gap-3 overflow-x-auto no-scrollbar shrink-0 w-full z-40">
            <input type="color" id="colorPicker" value="#000000" class="w-8 h-8 rounded cursor-pointer border-none bg-transparent shrink-0" onchange="updateStyle()">
            <input type="number" id="sizePicker" value="20" min="1" max="150" class="w-16 bg-slate-700 text-white px-2 py-1 rounded text-sm outline-none shrink-0" oninput="updateStyle()" placeholder="Size">
            <select id="fontFamily" onchange="updateStyle()" class="bg-slate-700 text-white px-2 py-1 rounded text-sm outline-none border-r-8 border-transparent shrink-0">
                <option value="Arial">Arial</option>
                <option value="Times New Roman">Times</option>
                <option value="Courier New">Courier</option>
            </select>
            <button onclick="deleteSelected()" class="ml-auto text-red-400 hover:text-red-300 p-1 text-xl shrink-0">ğŸ—‘ï¸</button>
        </div>

        <div id="workspace" class="flex-1 overflow-auto min-h-0 bg-slate-900 p-4 relative touch-pan-x touch-pan-y w-full">
            <div id="editor-placeholder" class="absolute inset-0 flex flex-col items-center justify-center text-slate-500 pointer-events-none z-10">
                <div class="text-5xl mb-4">ğŸ“„</div>
                <p>Open a PDF to start editing</p>
            </div>

            <div id="scroll-spacer" class="relative mx-auto transition-all duration-75">
                <div id="canvas-wrapper" class="hidden bg-white shadow-2xl origin-top-left absolute top-0 left-0">
                    <canvas id="main-canvas"></canvas>
                </div>
            </div>
        </div>

        <div class="bg-slate-800 border-t border-slate-700 p-2 flex flex-nowrap gap-1 overflow-x-auto no-scrollbar items-center shrink-0 w-full z-40 h-[72px]">
            <button id="tool-pan" onclick="setTool('pan')" class="ed-btn active-tool p-2 flex flex-col items-center rounded-lg min-w-[60px] text-slate-300 hover:bg-slate-700 shrink-0">
                <span class="text-xl">ğŸ–ï¸</span><span class="text-[10px] uppercase mt-1">Pan</span>
            </button>
            <div class="w-px h-8 bg-slate-700 mx-1 shrink-0"></div>
            <button id="tool-text" onclick="setTool('text')" class="ed-btn p-2 flex flex-col items-center rounded-lg min-w-[60px] text-slate-300 hover:bg-slate-700 shrink-0">
                <span class="text-xl">ğŸ“</span><span class="text-[10px] uppercase mt-1">Text</span>
            </button>
            <button id="tool-pen" onclick="setTool('pen')" class="ed-btn p-2 flex flex-col items-center rounded-lg min-w-[60px] text-slate-300 hover:bg-slate-700 shrink-0">
                <span class="text-xl">ğŸ–Šï¸</span><span class="text-[10px] uppercase mt-1">Pen</span>
            </button>
            <button id="tool-highlighter" onclick="setTool('highlighter')" class="ed-btn p-2 flex flex-col items-center rounded-lg min-w-[60px] text-slate-300 hover:bg-slate-700 shrink-0">
                <span class="text-xl">ğŸ–ï¸</span><span class="text-[10px] uppercase mt-1">Mark</span>
            </button>
            <div class="w-px h-8 bg-slate-700 mx-1 shrink-0"></div>
            <button onclick="openSignatureModal()" class="p-2 flex flex-col items-center rounded-lg min-w-[60px] text-slate-300 hover:bg-slate-700 shrink-0">
                <span class="text-xl">ğŸ–‹ï¸</span><span class="text-[10px] uppercase mt-1">Sign</span>
            </button>
            <button onclick="document.getElementById('upload-img').click()" class="p-2 flex flex-col items-center rounded-lg min-w-[60px] text-slate-300 hover:bg-slate-700 shrink-0">
                <span class="text-xl">ğŸ–¼ï¸</span><span class="text-[10px] uppercase mt-1">Image</span>
            </button>
            <div class="w-px h-8 bg-slate-700 mx-1 shrink-0"></div>
            <button onclick="setZoom(0.1)" class="p-2 flex flex-col items-center rounded-lg min-w-[60px] text-slate-300 hover:bg-slate-700 shrink-0">
                <span class="text-xl">ğŸ”+</span><span class="text-[10px] uppercase mt-1">Zoom In</span>
            </button>
            <button onclick="setZoom(-0.1)" class="p-2 flex flex-col items-center rounded-lg min-w-[60px] text-slate-300 hover:bg-slate-700 shrink-0">
                <span class="text-xl">ğŸ”-</span><span class="text-[10px] uppercase mt-1">Out</span>
            </button>
        </div>
    </div>

    <div id="organize-screen" class="screen hidden flex-col flex-1 min-h-0 relative w-full overflow-hidden">
        <div class="flex-1 min-h-0 overflow-y-auto p-6 w-full h-full">
            <div class="max-w-5xl mx-auto flex flex-col items-center">
                <div id="org-upload-box" class="border-2 border-dashed border-slate-600 rounded-xl p-10 text-center w-full max-w-lg cursor-pointer hover:bg-slate-800 hover:border-blue-500 transition-colors" onclick="document.getElementById('upload-org').click()">
                    <div class="mb-4 flex justify-center"><img src="https://cdn-icons-png.flaticon.com/512/1644/1644129.png" class="w-16 h-16 opacity-80"></div>
                    <h3 class="text-xl font-bold mb-2">Tap to select a PDF</h3><p class="text-slate-400">View, delete, and rearrange pages</p>
                </div>
                <div id="thumbnail-grid" class="flex flex-wrap gap-6 justify-center w-full mt-4"></div>
            </div>
        </div>
    </div>

    <div id="merge-screen" class="screen hidden flex-col flex-1 min-h-0 relative w-full overflow-hidden">
        <div class="flex-1 min-h-0 overflow-y-auto p-6 w-full h-full">
            <div class="max-w-5xl mx-auto flex flex-col items-center">
                <div class="border-2 border-dashed border-slate-600 rounded-xl p-10 text-center w-full max-w-lg cursor-pointer hover:bg-slate-800 hover:border-blue-500 transition-colors mb-6" onclick="document.getElementById('upload-merge').click()">
                    <div class="mb-4 flex justify-center"><img src="https://cdn-icons-png.flaticon.com/512/1644/1644129.png" class="w-16 h-16 opacity-80"></div>
                    <h3 class="text-xl font-bold mb-2">Tap to select multiple PDFs</h3><p class="text-slate-400">Select 2 or more files to combine them</p>
                </div>
                <div id="merge-list" class="w-full max-w-lg flex flex-col gap-3"></div>
            </div>
        </div>
    </div>

    <div id="split-screen" class="screen hidden flex-col flex-1 min-h-0 relative w-full overflow-hidden">
        <div class="flex-1 min-h-0 overflow-y-auto p-6 w-full h-full">
            <div class="max-w-5xl mx-auto flex flex-col items-center">
                <div id="split-upload-box" class="border-2 border-dashed border-slate-600 rounded-xl p-10 text-center w-full max-w-lg cursor-pointer hover:bg-slate-800 hover:border-blue-500 transition-colors" onclick="document.getElementById('upload-split').click()">
                    <div class="mb-4 flex justify-center"><img src="https://cdn-icons-png.flaticon.com/512/1644/1644129.png" class="w-16 h-16 opacity-80"></div>
                    <h3 class="text-xl font-bold mb-2">Tap to select a PDF</h3><p class="text-slate-400">Select specific pages to extract</p>
                </div>
                <div id="split-grid" class="flex flex-wrap gap-6 justify-center w-full mt-6"></div>
            </div>
        </div>
    </div>

    <div id="unsaved-modal" class="hidden fixed inset-0 bg-slate-900/80 backdrop-blur-sm z-[250] flex items-center justify-center p-4">
        <div class="bg-slate-800 border border-slate-700 p-6 rounded-2xl w-full max-w-sm shadow-2xl">
            <h3 class="text-xl font-bold mb-2 text-white">Unsaved Changes</h3>
            <p class="text-slate-400 mb-6">Are you sure you want to go back? Any unsaved edits will be lost.</p>
            <div class="flex justify-end gap-3">
                <button onclick="closeModal('unsaved-modal')" class="px-4 py-2 rounded-lg text-slate-300 hover:bg-slate-700">Cancel</button>
                <button onclick="confirmNavHome()" class="px-4 py-2 rounded-lg bg-red-600 hover:bg-red-500 font-medium shadow text-white">Discard & Exit</button>
            </div>
        </div>
    </div>

    <div id="loader-overlay" class="hidden fixed inset-0 bg-slate-900/90 backdrop-blur-sm z-[200] flex flex-col items-center justify-center">
        <div class="w-12 h-12 border-4 border-slate-600 border-t-blue-500 rounded-full animate-spin"></div>
        <div id="loader-text" class="mt-4 text-lg font-medium">Processing...</div>
    </div>

    <div id="save-modal" class="hidden fixed inset-0 bg-slate-900/80 backdrop-blur-sm z-[150] flex items-center justify-center p-4">
        <div class="bg-slate-800 border border-slate-700 p-6 rounded-2xl w-full max-w-sm shadow-2xl">
            <h3 class="text-xl font-bold mb-4">Save File As</h3>
            <input type="text" id="save-filename" class="w-full bg-slate-900 border border-slate-600 rounded-lg p-3 text-white mb-6 focus:border-blue-500 outline-none" value="Document">
            <div class="flex justify-end gap-3">
                <button onclick="closeModal('save-modal')" class="px-4 py-2 rounded-lg text-slate-300 hover:bg-slate-700">Cancel</button>
                <button id="save-confirm-btn" class="px-4 py-2 rounded-lg bg-green-600 hover:bg-green-500 font-medium shadow">Save Document</button>
            </div>
        </div>
    </div>

    <div id="export-modal" class="hidden fixed inset-0 bg-slate-900/80 backdrop-blur-sm z-[150] flex items-center justify-center p-4">
        <div class="bg-slate-800 border border-slate-700 p-6 rounded-2xl w-full max-w-sm shadow-2xl">
            <h3 class="text-xl font-bold mb-4">Export File</h3>
            <label class="text-xs text-slate-400 uppercase tracking-wider">File Name</label>
            <input type="text" id="export-name" class="w-full bg-slate-900 border border-slate-600 rounded-lg p-3 text-white mt-1 mb-4 focus:border-blue-500 outline-none" value="Edited_Document">
            <label class="text-xs text-slate-400 uppercase tracking-wider">Format</label>
            <select id="export-format" class="w-full bg-slate-900 border border-slate-600 rounded-lg p-3 text-white mt-1 mb-6 outline-none">
                <option value="pdf">Save as PDF (All Pages)</option>
                <option value="png">Save Page as Image (PNG)</option>
            </select>
            <div class="flex justify-end gap-3">
                <button onclick="closeModal('export-modal')" class="px-4 py-2 rounded-lg text-slate-300 hover:bg-slate-700">Cancel</button>
                <button onclick="executeExport()" class="px-4 py-2 rounded-lg bg-green-600 hover:bg-green-500 font-medium shadow">Download</button>
            </div>
        </div>
    </div>

    <div id="sig-modal" class="hidden fixed inset-0 bg-slate-900/80 backdrop-blur-sm z-[150] flex items-center justify-center p-4">
        <div class="bg-slate-800 border border-slate-700 p-6 rounded-2xl w-full max-w-md shadow-2xl">
            <h3 class="text-xl font-bold mb-4">Sign Document</h3>
            <div id="sig-container" class="bg-white rounded-lg border-2 border-dashed border-slate-400 overflow-hidden touch-none mb-4">
                <canvas id="sig-canvas" width="350" height="150" class="w-full"></canvas>
            </div>
            <div class="flex justify-between items-center">
                <button onclick="clearSignature()" class="text-slate-400 hover:text-white px-2 py-1">Clear</button>
                <div class="flex gap-2">
                    <button onclick="closeModal('sig-modal')" class="px-4 py-2 rounded-lg text-slate-300 hover:bg-slate-700">Cancel</button>
                    <button onclick="saveSignature()" class="px-4 py-2 rounded-lg bg-blue-600 hover:bg-blue-500 font-medium shadow">Insert Signature</button>
                </div>
            </div>
        </div>
    </div>

    <div id="ios-install-modal" class="hidden fixed inset-0 bg-slate-900/80 backdrop-blur-sm z-[150] flex items-end justify-center sm:items-center p-4 pb-10">
        <div class="bg-slate-800 border border-slate-700 p-6 rounded-2xl w-full max-w-sm shadow-2xl text-center">
            <div class="text-4xl mb-4">ğŸ“²</div>
            <h3 class="text-xl font-bold mb-2">Install App on Phone</h3>
            <p class="text-slate-400 mb-6">Tap the <b>Share / Options</b> menu in your browser, then scroll down and select <b>"Add to Home Screen"</b> to install the app.</p>
            <button onclick="closeModal('ios-install-modal')" class="w-full px-4 py-3 rounded-lg bg-blue-600 hover:bg-blue-500 font-medium shadow">Got it</button>
        </div>
    </div>

    <input type="file" id="upload-pdf" accept="application/pdf" class="hidden">
    <input type="file" id="upload-img" accept="image/*" class="hidden" onchange="handleImageUpload(event)">
    <input type="file" id="upload-org" accept="application/pdf" class="hidden">
    <input type="file" id="upload-merge" accept="application/pdf" multiple class="hidden">
    <input type="file" id="upload-split" accept="application/pdf" class="hidden">

    <style> .active-tool { background: rgba(59, 130, 246, 0.2); color: #60a5fa; outline: 1px solid #3b82f6; } </style>
    <script src="./app.js"></script>
</body>
</html>